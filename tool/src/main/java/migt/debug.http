POST localhost:3000/execute
Content-Type: application/json

{
    "test": "{\r\n  \"test suite\": {\r\n    \"name\": \"Single test\",\r\n    \"description\": \"One test only\",\r\n    \"filter messages\": true\r\n  },\r\n  \"tests\": [\r\n    {\r\n      \"test\": {\r\n        \"name\": \"Does the OP release Access Tokens with the use of refresh tokens\",\r\n        \"description\": \"In this test the offline access flow is accomplished and a refresh token is obtained. After this, a new token request is done with \\\"grant_type=refresh_token\\\" and the refresh token inserted in the \\\"refresh_token\\\" parameter. The response must include the Access Token\",\r\n        \"type\": \"active\",\r\n        \"sessions\": [\r\n          \"s1\",\r\n          \"s1.1\",\r\n          \"s1.2\"\r\n        ],\r\n        \"operations\": [\r\n          {\r\n            \"session\": \"s1\",\r\n            \"action\": \"start\"\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Authentication request\",\r\n            \"decode operations\": [\r\n              {\r\n                \"from\": \"url\",\r\n                \"decode param\": \"request\",\r\n                \"type\": \"jwt\",\r\n                \"edits\": [\r\n                  {\r\n                    \"jwt from\": \"payload\",\r\n                    \"jwt edit\": \"$.acr_values\",\r\n                    \"value\": \"https:\/\/www.spid.gov.it\/SpidL1\"\r\n                  },\r\n                  {\r\n                    \"jwt sign\": \"X_key_core_RP\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token response\",\r\n            \"message operations\": [\r\n              {\r\n                \"from\": \"body\",\r\n                \"save\": \"(?<=\\\"refresh_token\\\": \\\")[^\\\"]+\",\r\n                \"as\": \"saved_refresh_token\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"session\": \"s1\",\r\n            \"action\": \"pause\"\r\n          },\r\n          {\r\n            \"session\": \"s1.1\",\r\n            \"action\": \"start\"\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token request\",\r\n            \"edit operations\": [\r\n              {\r\n                \"from\": \"body\",\r\n                \"edit regex\": \"(?<=grant_type=)([^&\\\\n]+)\",\r\n                \"value\": \"refresh_token\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"value\": \"&refresh_token=\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"use\": \"saved_refresh_token\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"UserInfo request\"\r\n          },\r\n          {\r\n            \"session\": \"s1.1\",\r\n            \"action\": \"pause\"\r\n          },\r\n          {\r\n            \"session\": \"s1.2\",\r\n            \"action\": \"start\"\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.2\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token request\",\r\n            \"edit operations\": [\r\n              {\r\n                \"from\": \"body\",\r\n                \"edit regex\": \"(?<=grant_type=)([^&\\\\n]+)\",\r\n                \"value\": \"refresh_token\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"value\": \"&refresh_token=\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"use\": \"saved_refresh_token\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.2\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token response\",\r\n            \"checks\": [\r\n              {\r\n                \"in\": \"head\",\r\n                \"check regex\": \"HTTP\/?\\\\d?\\\\.?\\\\d?\\\\s400\"\r\n              },\r\n              {\r\n                \"in\": \"body\",\r\n                \"check\": \"invalid_request\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"session\": \"s1\",\r\n            \"action\": \"resume\"\r\n          },\r\n          {\r\n            \"session\": \"s1.1\",\r\n            \"action\": \"resume\"\r\n          }\r\n        ],\r\n        \"result\": \"assert_only\"\r\n      }\r\n    }\r\n  ]\r\n}",
    "sessions": {
      "main": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000",
      "s1": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000",
      "s1.1": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000",
      "s1.2": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000"
    }
}