POST localhost:3000/execute
Content-Type: application/json
# X-AuthKey: ciao

{
    "test": "{\r\n  \"test suite\": {\r\n    \"name\": \"Single test\",\r\n    \"description\": \"One test only\",\r\n    \"filter messages\": true\r\n  },\r\n  \"tests\": [\r\n    {\r\n      \"test\": {\r\n        \"name\": \"Does the OP release Access Tokens with the use of refresh tokens\",\r\n        \"description\": \"In this test the offline access flow is accomplished and a refresh token is obtained. After this, a new token request is done with \\\"grant_type=refresh_token\\\" and the refresh token inserted in the \\\"refresh_token\\\" parameter. The response must include the Access Token\",\r\n        \"type\": \"active\",\r\n        \"sessions\": [\r\n          \"s1\",\r\n          \"s1.1\",\r\n          \"s1.2\"\r\n        ],\r\n        \"operations\": [\r\n          {\r\n            \"session\": \"s1\",\r\n            \"action\": \"start\"\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Authentication request\",\r\n            \"decode operations\": [\r\n              {\r\n                \"from\": \"url\",\r\n                \"decode param\": \"request\",\r\n                \"type\": \"jwt\",\r\n                \"edits\": [\r\n                  {\r\n                    \"jwt from\": \"payload\",\r\n                    \"jwt edit\": \"$.acr_values\",\r\n                    \"value\": \"https:\/\/www.spid.gov.it\/SpidL1\"\r\n                  },\r\n                  {\r\n                    \"jwt sign\": \"-----BEGIN PRIVATE KEY-----\\nMIIEvwIBADANBgkqhkiG9w0BAQEFAASCBKkwggSlAgEAAoIBAQC5d8kD7BOVMIDg\\nV2ygTSpl+YoiB52Zquu1aBBsSUptaD1ENHtnwlUFpEsWrDJ\/IbUkkWbrgbnVwEnA\\nsgXBagXufGwf1VgubmhyMCexHhGGV9UTTL\/rTCN\/yyQmAFGmJdA+XAf2MMZqpUT8\\n8QFM5sM7nDdei6sPUXfrT6\/lwsMtEd0UkiK10RW2oBOpjkOCVENoqIGGKztrn\/Vu\\nTzf08MtpCGO7hcmTi28PLn4tWQzLmw\/bNTr7W0l0D5WZoFktfL2fT3rsUYhaYzOl\\np+sEw64cVxQ4fnqj5yUNqH8IhMfV2rYPrgrQxiESkAI7anwAfgrxDpi4nV2eRUMP\\nBmnYLzixAgMBAAECggEBAJ\/3jyuQ3TsagK3++bQxmlYmK1w6kVZPM8pdnXyookdH\\nV0CSu7W8ybR6BkHh+BPrMN\/\/gXOzimOw3GwVoB04ozEVo\/S5ALvbgr6qhjGgK6Fh\\n9GgXFJmQLDY3MlCMid\/yUXDX1A4l951YOu6nuGVpzA6IKMGlWb92lyYgryhPGiSu\\nAVf5xdzbeUes1GKY2UPE9Rg2Qld782t6oJQ613vM6HPqfHC7N6yZ+7TFUiVc5wiK\\njn3jNVSINCN59m7m2DsfPLHJB7g53104kw5cquSMA8gR5oiHt36bvnOHtbYgZmzn\\n9iKgwml\/EnaZ1NoE4\/WJWbUTapodzQf65LASli897iECgYEA5PA7lJEDd3vrw5hl\\nolFzvjvRriOu1SMHXx9Y52AgpOeQ6MnE1pO8qwn33lwYTSPGYinaq4jS3FKF\/U5v\\nOZltJAGBMa4ByEvAROJVCh958rKVRWKIqVXLOi8Gk11kHbVKw6oDXAd8Qt\/y\/ff8\\nk\/K6jW2EbWm1K6kfTvTMzoHkqrUCgYEAz2QeMH4WtrdiWUET7JgZNX0TbcaVBgd2\\nGpo8JHnfnGOUsvO\/euKGgqpCcxiWVXSlqffQyTgVzl4iMROP8bEaQwvueHurtziM\\nDSy9Suumyktu3PbGgjqu\/izRim8Xlg7sz8Hs2quJPII\/fQ8BCoaWpg30osFZqCBa\\nrQM7CWhxR40CgYA3CVWZap8lu0G7XMiaE\/C6O9E1htiB3pDoGjYaMW7Hle+tNsw+\\nNXf2uke\/Se6BpOcNNDigYh0m4CPb+F4ev7aQIFh5o\/ZDu4o2RR7idxyu7qWZ740h\\nAEIB88ol5R6rUajujtGN7zK9NO9KhLJQstqMI1bhorbuDxM6vPj7cBiTvQKBgQDJ\\nfuJ+BuOWntHlGf97rcNAXsdTrs73TqSG8Ddi0S5ayb2dqIjvoctChJ2PKeJWIMEc\\nRHQMLHuzR2489F60WnfDkIIfeTi7CSu5WTCI7C\/e+C88bF8uBEolFfJ4Z7soxlN6\\n\/1Val7L8oSeCH+PJED6qE4EN6IFtghHXav4fA+SbuQKBgQCNy7q3MoBOxDlKOpSN\\nChoYUfW0JvwJbyyaVYOVq0efGVobosAblE\/IuwaoIuVgh8c4T3qZtwFcSpvfR5Qy\\nSOWFs2QXN\/P4ZvmiVpXK\/9Tcnth2BThpb9apQCT2a\/CYtrRiGNAVWKiK0U9QlN\/w\\n9fVBO\/ZgdaXE4xqYOSceH14yrQ==\\n-----END PRIVATE KEY-----\\n\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token response\",\r\n            \"message operations\": [\r\n              {\r\n                \"from\": \"body\",\r\n                \"save\": \"(?<=\\\"refresh_token\\\": \\\")[^\\\"]+\",\r\n                \"as\": \"saved_refresh_token\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"session\": \"s1\",\r\n            \"action\": \"pause\"\r\n          },\r\n          {\r\n            \"session\": \"s1.1\",\r\n            \"action\": \"start\"\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token request\",\r\n            \"edit operations\": [\r\n              {\r\n                \"from\": \"body\",\r\n                \"edit regex\": \"(?<=grant_type=)([^&\\\\n]+)\",\r\n                \"value\": \"refresh_token\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"value\": \"&refresh_token=\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"use\": \"saved_refresh_token\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.1\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"UserInfo request\"\r\n          },\r\n          {\r\n            \"session\": \"s1.1\",\r\n            \"action\": \"pause\"\r\n          },\r\n          {\r\n            \"session\": \"s1.2\",\r\n            \"action\": \"start\"\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.2\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token request\",\r\n            \"edit operations\": [\r\n              {\r\n                \"from\": \"body\",\r\n                \"edit regex\": \"(?<=grant_type=)([^&\\\\n]+)\",\r\n                \"value\": \"refresh_token\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"value\": \"&refresh_token=\"\r\n              },\r\n              {\r\n                \"from\": \"body\",\r\n                \"add\": \"\",\r\n                \"use\": \"saved_refresh_token\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"action\": \"intercept\",\r\n            \"from session\": \"s1.2\",\r\n            \"then\": \"forward\",\r\n            \"message type\": \"Token response\",\r\n            \"checks\": [\r\n              {\r\n                \"in\": \"head\",\r\n                \"check regex\": \"HTTP\/?\\\\d?\\\\.?\\\\d?\\\\s400\"\r\n              },\r\n              {\r\n                \"in\": \"body\",\r\n                \"check\": \"invalid_request\"\r\n              }\r\n            ]\r\n          },\r\n          {\r\n            \"session\": \"s1\",\r\n            \"action\": \"resume\"\r\n          },\r\n          {\r\n            \"session\": \"s1.1\",\r\n            \"action\": \"resume\"\r\n          }\r\n        ],\r\n        \"result\": \"assert_only\"\r\n      }\r\n    }\r\n  ]\r\n}",
    "sessions": {
      "main": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000",
      "s1": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000",
      "s1.1": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000",
      "s1.2": "open | http:\/\/relying-party.org:8001\/oidc\/rp\/landing |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/a |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div\/span[2]\/div\/ul\/li[2]\/a |\r\ntype | id=id_username | user\r\ntype | id=id_password | oidcuser\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/div[2]\/div[2]\/div[1]\/form\/fieldset\/div\/div\/div\/div[3]\/button\/span[2] |\r\nclick | id=agree |\r\nclick | xpath=\/html\/body\/div[2]\/div\/div\/div\/div\/div\/div\/div\/div\/div\/a |\r\nwait | 1000"
    }
}

###
POST localhost:3000/result


###
POST localhost:3000/result?verbose=true

